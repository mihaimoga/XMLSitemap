<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Benchmarks against the official connectors</title>
<link rel="stylesheet" href="../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../index.html" title="Chapter 1. Boost.MySQL">
<link rel="up" href="../index.html" title="Chapter 1. Boost.MySQL">
<link rel="prev" href="pipeline.html" title="(Experimental) Pipelines">
<link rel="next" href="examples.html" title="Examples">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="pipeline.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="examples.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="mysql.benchmarks"></a><a class="link" href="benchmarks.html" title="Benchmarks against the official connectors">Benchmarks against the official connectors</a>
</h2></div></div></div>
<p>
      MySQL and MariaDB ship with official C connectors: <a href="https://dev.mysql.com/downloads/c-api/" target="_top">libmysqlclient</a>
      and <a href="https://mariadb.com/kb/en/mariadb-connectorc-api-functions/" target="_top">libmariadb</a>.
      Both implement the client/server protocol, as Boost.MySQL does. The question
      then arises: is Boost.MySQL as fast as the official drivers?
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        TL;DR: Boost.MySQL is as fast as the official C APIs, and may be faster under
        some circumstances.
      </p></td></tr>
</table></div>
<h4>
<a name="mysql.benchmarks.h0"></a>
      <span class="phrase"><a name="mysql.benchmarks.design_decisions"></a></span><a class="link" href="benchmarks.html#mysql.benchmarks.design_decisions">Design
      decisions</a>
    </h4>
<p>
      These benchmarks focus on <span class="bold"><strong>the speed of the protocol implementation</strong></span>,
      in an attempt to answer the question above. This should take into account,
      at least, (de)serialization and buffering. It shouldn't take into account features
      unique to Boost.MySQL, like the static interface or connection pooling.
    </p>
<p>
      Both libmysqlclient and libmariadb offer a connection type, similar to <a class="link" href="ref/boost__mysql__any_connection.html" title="any_connection"><code class="literal">any_connection</code></a>,
      with both sync and async primitives. Sync functions are similar to the ones
      in Boost.MySQL (although C-flavored). Async functions are much lower-level,
      and often require either integration into a framework (like Asio or libuv)
      or writing <code class="computeroutput"><span class="identifier">poll</span></code>/<code class="computeroutput"><span class="identifier">epoll</span></code> code by hand. None of these options
      is trivial. Additionally, sync functions have less overhead, so they're best
      suited to answer our question. For this reason, <span class="bold"><strong>we only
      use sync functions</strong></span> in the benchmarks.
    </p>
<p>
      The benchmarks <span class="bold"><strong>use prepared statements only</strong></span>.
      The official drivers handle text queries (issued by <code class="computeroutput"><span class="identifier">mysql_real_query</span></code>)
      and prepared statements differently. Rows generated by text queries are returned
      as strings, and need to be parsed by the user. Boost.MySQL handles this parsing
      automatically for you. For this reason, comparing text queries doesn't make
      much sense. Prepared statements are handled similarly, and are better suited
      for big rows and datasets.
    </p>
<p>
      <span class="bold"><strong>All tests use a real database</strong></span>. Neither Boost.MySQL
      nor the official C clients expose (de)serialization functions. Buffering and
      optimizing the number of system calls is also critical for efficiency, and
      can only be measured with real communication. The downside is that database
      processing introduces delays, and might end up being the bottleneck.
    </p>
<p>
      The benchmarks try to <span class="bold"><strong>minimize communication overhead
      by using UNIX sockets</strong></span>.
    </p>
<h4>
<a name="mysql.benchmarks.h1"></a>
      <span class="phrase"><a name="mysql.benchmarks.benchmark_procedure"></a></span><a class="link" href="benchmarks.html#mysql.benchmarks.benchmark_procedure">Benchmark
      procedure</a>
    </h4>
<p>
      Benchmark source code can be found in the <a href="https://github.com/boostorg/mysql/tree/master/bench" target="_top">bench/</a>
      folder of the repo. The following benchmarks are performed:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          One small row. Executes a statement yielding a single row with 15 fields,
          including most of the possible types. Each row weighs around 500 bytes.
          Execution is repeated 10000 times. The Boost.MySQL version uses <a class="link" href="ref/boost__mysql__any_connection/execute.html" title="any_connection::execute"><code class="literal">any_connection::execute</code></a>.
        </li>
<li class="listitem">
          One big row. Like the above, but rows have 17 fields, and each row weighs
          between 72 and 108 KB. The Boost.MySQL version uses <a class="link" href="ref/boost__mysql__any_connection/start_execution.html" title="any_connection::start_execution"><code class="literal">any_connection::start_execution</code></a>,
          which allows zero-copying.
        </li>
<li class="listitem">
          Many rows. Executes a statement that yields 5000 of the "big rows"
          described above. The statement is executed only once. The Boost.MySQL version
          uses <a class="link" href="ref/boost__mysql__any_connection/start_execution.html" title="any_connection::start_execution"><code class="literal">any_connection::start_execution</code></a>
          because the resultset size is big.
        </li>
<li class="listitem">
          Statement with parameters. Executes a statement with 17 parameters, roughly
          matching the "big row" structure described above. Intended to
          measure serialization speed. The statement is executed 1000 times.
        </li>
</ul></div>
<p>
      Benchmark conditions:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          Database: MySQL 8.4.1, running on a Docker container in localhost.
        </li>
<li class="listitem">
          OS: Ubuntu 24.04
        </li>
<li class="listitem">
          CPU: Intel(R) Core(TM) i7-10510U CPU @ 1.80GHz, 8 cores.
        </li>
<li class="listitem">
          Compiler: g++-14, using CMake's Release config, C++23.
        </li>
<li class="listitem">
          MySQL C API: libmysqlclient24 (as included in the official MySQL 8.4.4
          release).
        </li>
<li class="listitem">
          MariaDB C API: libmariadb3 1:10.11.11-0ubuntu0.24.04.2 (official Ubuntu
          package).
        </li>
<li class="listitem">
          Boost.MySQL: Boost 1.87.0. The header-only version is used (without defining
          <code class="computeroutput"><span class="identifier">BOOST_MYSQL_SEPARATE_COMPILATION</span></code>),
          since it's slightly faster.
        </li>
</ul></div>
<h4>
<a name="mysql.benchmarks.h2"></a>
      <span class="phrase"><a name="mysql.benchmarks.results"></a></span><a class="link" href="benchmarks.html#mysql.benchmarks.results">Results</a>
    </h4>
<p>
      <span class="inlinemediaobject"><img src="images/bench-protocol.png" align="middle"></span>
    </p>
<p>
      The three libraries exhibit a similar level of performance, which is expected
      from a correctly implemented binary protocol. Boost.MySQL outperforms libmysqlclient
      in the single row benchmarks, and is on par with libmariadb. Differences in
      the other benchmarks don't appear to be statistically significant.
    </p>
<p>
      During these benchmarks, some potential performance improvement areas have
      been identified. See [https://github.com/boostorg/mysql/issues/458 this issue]
      for details.
    </p>
<p>
      Remember that protocol is just one piece to the whole puzzle. Correctly using
      features like <a class="link" href="ref/boost__mysql__connection_pool.html" title="connection_pool"><code class="literal">connection_pool</code></a>,
      <a class="link" href="ref/boost__mysql__with_params.html" title="with_params"><code class="literal">with_params</code></a>,
      multi-function operations and multi-queries can make a huge performance difference
      in your application. Never assume anything and always measure!
    </p>
<p>
      Acknowledgments: thanks <a href="https://github.com/LowLevelMahn" target="_top">LowLevelMahn</a>
      for proposing the benchmarks.
    </p>
</div>
<div class="copyright-footer">Copyright © 2019-2024 Ruben Perez<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="pipeline.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="examples.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
